alfresco.xforms.constants.XFORMS_CSS_SELECT_QUERY="input:enabled,area:tabindex,button:tabindex,object:tabindex,select:tabindex,textarea:tabindex";alfresco.xforms.constants.XFORMS_FOCUSABLE_ELEMENTS=["INPUT","AREA","BUTTON","OBJECT","SELECT","TEXTAREA"];(function(){var c=tinymce.DOM,a=tinymce.dom.Event,d=tinymce.each,b=tinymce.explode;tinymce.create("tinymce.plugins.XFormsTabFocusPlugin",{init:function(f,g){function e(i,k){var j=(k.which)?(k.wich):(k.keyCode);if(9===j){return a.cancel(k)}}function h(i,m){function n(x){var v=-1;var t=alfresco.xforms.constants.XFORMS_CSS_SELECT_QUERY;if((null!=x.editorCondition)&&(x.editorCondition.length>0)){t+=",*["+x.editorCondition+"]"}var r=((null!=x.forwardClasses)&&(x.forwardClasses.length>0))?(b(x.forwardClasses," ")):(null);var w=((null!=x.backwardClasses)&&(x.backwardClasses.length>0))?(b(x.backwardClasses," ")):(null);function u(y){d(y,function(z){t+=',a[class~="'+z+'"]';return true})}if(r){u(r)}if(w){u(w)}var o=((null!=x.formScopeId)&&(x.formScopeId.length>0))?(c.select(t,document.getElementById(x.formScopeId))):(c.select(t));if(o){var s=c.select("*["+x.editorCondition+"]");d(o,function(z,y){if(s.toString()==z.toString()){v=y;return false}return true});function p(A,z){if(null==z){return false}for(var y=0;y<A.length;y++){if(!c.hasClass(z,A[y])){return false}}return true}for(var q=(v+x.direction);(x.direction>0)?(q<o.length):(q>=0);q+=x.direction){if(!o[q].hidden&&("none"!=o[q].style.display)&&(o[q].tabIndex>=0)){if((("A"==o[q].tagName)&&p((x.direction>0)?(r):(w),o[q]))||(-1!=alfresco.xforms.constants.XFORMS_FOCUSABLE_ELEMENTS.indexOf(o[q].tagName))){return o[q]}}}}return null}var l=(m.which)?(m.which):(m.keyCode);if(9===l){var j={direction:(m.shiftKey)?(-1):(1),formScopeId:i.getParam("form_scope_id"),editorCondition:i.getParam("editor_condition"),forwardClasses:i.getParam("forward_element_classes"),backwardClasses:i.getParam("backward_element_classes")};var k=n(j);if(k){if(i=tinymce.EditorManager.get(k.id||k.name)){i.focus()}else{window.setTimeout(function(){window.focus();k.focus()},10)}return a.cancel(m)}}return true}f.onKeyUp.add(e);if(tinymce.isGecko){f.onKeyPress.add(h);f.onKeyDown.add(e)}else{f.onKeyDown.add(h)}},getInfo:function(){var e={longname:"XFormsTabFocus",author:"Dmitry Velichkevich",infourl:"http://alfresco.com/",version:tinymce.majorVersion+"."+tinymce.minorVersion};return e}});tinymce.PluginManager.add("xformstabfocus",tinymce.plugins.XFormsTabFocusPlugin)})();