<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE beans PUBLIC '-//SPRING//DTD BEAN//EN' 'http://www.springframework.org/dtd/spring-beans.dtd'>

<beans>

    <!-- Records Management Service Registry -->

    <bean id="RecordsManagementServiceRegistry" class="org.alfresco.module.org_alfresco_module_dod5015.RecordsManagementServiceRegistryImpl" />    
    
    <!-- Disposition selection strategy -->
    <bean id="org_alfresco_module_dod5015_dispositionSelectionStrategy"
          class="org.alfresco.module.org_alfresco_module_dod5015.disposition.DispositionSelectionStrategy" >        
        <property name="dispositionService" ref="dispositionService"/>
    </bean>    

    <!-- Records Management Service -->
    
    <bean id="recordsManagementService" class="org.alfresco.module.org_alfresco_module_dod5015.RecordsManagementServiceImpl"
          depends-on="org_alfresco_module_dod5015_dictionaryBootstrap" init-method="init">        
        <property name="recordsManagementServiceRegistry" ref="RecordsManagementServiceRegistry"/>
        <property name="rmActionService" ref="recordsManagementActionService"/>
        <property name="nodeService" ref="nodeService"/>
        <property name="policyComponent" ref="policyComponent"/>
        <property name="nodeDAO" ref="nodeDAO"/>
    </bean>
    
    <bean id="RecordsManagementService" class="org.springframework.aop.framework.ProxyFactoryBean">
        <property name="proxyInterfaces">
            <value>org.alfresco.module.org_alfresco_module_dod5015.RecordsManagementService</value>
        </property>
        <property name="target">
            <ref bean="recordsManagementService"/>
        </property>
        <property name="interceptorNames">
            <list>
                <idref local="RecordsManagementService_transaction"/>
                <idref bean="exceptionTranslator"/>
                <idref local="RecordsManagementService_security"/>
            </list>
        </property>
    </bean>

    <bean id="RecordsManagementService_transaction" class="org.springframework.transaction.interceptor.TransactionInterceptor">
        <property name="transactionManager">
            <ref bean="transactionManager"/>
        </property>
        <property name="transactionAttributes">
            <props>
                <prop key="*">${server.transaction.mode.default}</prop>
            </props>
        </property>
    </bean>

    <bean id="RecordsManagementService_security" class="org.alfresco.repo.security.permissions.impl.acegi.MethodSecurityInterceptor">
        <property name="authenticationManager">
            <ref bean="authenticationManager"/>
        </property>
        <property name="accessDecisionManager">
            <ref bean="accessDecisionManager"/>
        </property>
        <property name="afterInvocationManager">
            <ref bean="afterInvocationManager"/>
        </property>
        <property name="objectDefinitionSource">
            <value>
                <![CDATA[
                org.alfresco.module.org_alfresco_module_dod5015.RecordsManagementService.isRecordsManagmentComponent=RM.Read.0
                org.alfresco.module.org_alfresco_module_dod5015.RecordsManagementService.isRecordsManagementRoot=RM.Read.0
                org.alfresco.module.org_alfresco_module_dod5015.RecordsManagementService.isRecordsManagementContainer=RM.Read.0
                org.alfresco.module.org_alfresco_module_dod5015.RecordsManagementService.isRecordFolder=RM.Read.0
                org.alfresco.module.org_alfresco_module_dod5015.RecordsManagementService.isRecord=RM.Read.0
                org.alfresco.module.org_alfresco_module_dod5015.RecordsManagementService.getNodeRefPath=RM.Read.0
                org.alfresco.module.org_alfresco_module_dod5015.RecordsManagementService.getRecordsManagementRoot=RM.Read.0,AFTER_RM.FilterNode
                org.alfresco.module.org_alfresco_module_dod5015.RecordsManagementService.getRecordsManagementRoots=RM_ALLOW
                org.alfresco.module.org_alfresco_module_dod5015.RecordsManagementService.createRecordsManagementRoot=RM.WRITE.0
                org.alfresco.module.org_alfresco_module_dod5015.RecordsManagementService.getAllContained=RM.Read.0,AFTER_RM.FilterNode
                org.alfresco.module.org_alfresco_module_dod5015.RecordsManagementService.getContainedRecordsManagementContainers=RM.Read.0,AFTER_RM.FilterNode
                org.alfresco.module.org_alfresco_module_dod5015.RecordsManagementService.getContainedRecordFolders=RM.Read.0,AFTER_RM.FilterNode
                org.alfresco.module.org_alfresco_module_dod5015.RecordsManagementService.createRecordsManagementContainer=RM.Write.0
                org.alfresco.module.org_alfresco_module_dod5015.RecordsManagementService.isRecordFolderDeclared=RM.Read.0
                org.alfresco.module.org_alfresco_module_dod5015.RecordsManagementService.createRecordFolder=RM.Write.0                
                org.alfresco.module.org_alfresco_module_dod5015.RecordsManagementService.getRecords=RM.Read.0,AFTER_RM.FilterNode       
                org.alfresco.module.org_alfresco_module_dod5015.RecordsManagementService.getRecordMetaDataAspects=RM_ALLOW
                org.alfresco.module.org_alfresco_module_dod5015.RecordsManagementService.getRecordFolders=RM.Read.0,AFTER_RM.FilterNode                
                org.alfresco.module.org_alfresco_module_dod5015.RecordsManagementService.isRecordDeclared=RM.Read.0
                org.alfresco.module.org_alfresco_module_dod5015.RecordsManagementService.getVitalRecordDefinition=RM.Read.0
                org.alfresco.module.org_alfresco_module_dod5015.RecordsManagementService.*=RM_DENY
                ]]>
            </value>
        </property>
    </bean>
    
    <!--  Disposition Service -->
    
    <bean id="dispositionService" class="org.alfresco.module.org_alfresco_module_dod5015.disposition.DispositionServiceImpl">        
        <property name="recordsManagementServiceRegistry" ref="RecordsManagementServiceRegistry"/>
        <property name="nodeService" ref="NodeService"/>
        <property name="dictionaryService" ref="DictionaryService"/>
        <property name="behaviourFilter" ref="policyBehaviourFilter" /> 	
        <property name="dispositionSelectionStrategy">
           <ref local="org_alfresco_module_dod5015_dispositionSelectionStrategy" />
        </property>
    </bean>
    
    <bean id="DispositionService" class="org.springframework.aop.framework.ProxyFactoryBean">
        <property name="proxyInterfaces">
            <value>org.alfresco.module.org_alfresco_module_dod5015.disposition.DispositionService</value>
        </property>
        <property name="target">
            <ref bean="dispositionService"/>
        </property>
        <property name="interceptorNames">
            <list>
                <idref local="DispositionService_transaction"/>
                <idref bean="exceptionTranslator"/>
                <idref local="DispositionService_security"/>
            </list>
        </property>
    </bean>

    <bean id="DispositionService_transaction" class="org.springframework.transaction.interceptor.TransactionInterceptor">
        <property name="transactionManager">
            <ref bean="transactionManager"/>
        </property>
        <property name="transactionAttributes">
            <props>
                <prop key="*">${server.transaction.mode.default}</prop>
            </props>
        </property>
    </bean>

    <bean id="DispositionService_security" class="org.alfresco.repo.security.permissions.impl.acegi.MethodSecurityInterceptor">
        <property name="authenticationManager">
            <ref bean="authenticationManager"/>
        </property>
        <property name="accessDecisionManager">
            <ref bean="accessDecisionManager"/>
        </property>
        <property name="afterInvocationManager">
            <ref bean="afterInvocationManager"/>
        </property>
        <property name="objectDefinitionSource">
            <value>
                <![CDATA[
                org.alfresco.module.org_alfresco_module_dod5015.disposition.DispositionService.getDispositionSchedule=RM.Read.0
                org.alfresco.module.org_alfresco_module_dod5015.disposition.DispositionService.getAssociatedDispositionSchedule=RM.Read.0
                org.alfresco.module.org_alfresco_module_dod5015.disposition.DispositionService.getAssociatedRecordsManagementContainer=RM_ALLOW
                org.alfresco.module.org_alfresco_module_dod5015.disposition.DispositionService.hasDisposableItems=RM_ALLOW
                org.alfresco.module.org_alfresco_module_dod5015.disposition.DispositionService.getDisposableItems=RM_ALLOW
                org.alfresco.module.org_alfresco_module_dod5015.disposition.DispositionService.createDispositionSchedule=RM_ALLOW               
                org.alfresco.module.org_alfresco_module_dod5015.disposition.DispositionService.addDispositionActionDefinition=RM_ALLOW
                org.alfresco.module.org_alfresco_module_dod5015.disposition.DispositionService.removeDispositionActionDefinition=RM_ALLOW
                org.alfresco.module.org_alfresco_module_dod5015.disposition.DispositionService.updateDispositionActionDefinition=RM_ALLOW
                org.alfresco.module.org_alfresco_module_dod5015.disposition.DispositionService.isNextDispositionActionEligible=RM.Read.0
                org.alfresco.module.org_alfresco_module_dod5015.disposition.DispositionService.getNextDispositionAction=RM.Read.0
                org.alfresco.module.org_alfresco_module_dod5015.disposition.DispositionService.getCompletedDispositionActions=RM.Read.0
                org.alfresco.module.org_alfresco_module_dod5015.disposition.DispositionService.getLastCompletedDispostionAction=RM.Read.0                 
                org.alfresco.module.org_alfresco_module_dod5015.disposition.DispositionService.getDispositionPeriodProperties=RM.Read.0               
                org.alfresco.module.org_alfresco_module_dod5015.disposition.DispositionService.*=RM_DENY
                ]]>
            </value>
        </property>
    </bean>
    
    <!--  Records Management Search Service -->
    
    <bean id="recordsManagementSearchService" class="org.alfresco.module.org_alfresco_module_dod5015.search.RecordsManagementSearchServiceImpl">        
        <property name="fileFolderService" ref="FileFolderService"/>
        <property name="siteService" ref="SiteService"/>  
        <property name="namespaceService" ref="NamespaceService" />
        <property name="searchService" ref="SearchService" />
        <property name="reportsJSON">
        	<value>
                <![CDATA[
                [
                	{
                		"name" : "Vital Records Due For Review",
                		"description" : "All records currently due for review.",
                		"search" : "reviewAsOf:[MIN TO TODAY]",
                		"searchparams" :
                		{
                			"records" : true,
                			"vitalrecords" : true
                		}                		
                	},
                	{
                		"name" : "Undeclared Records",
                		"description" : "All undeclared records.",
                		"search" : "ISNODE:T AND NOT ASPECT:\"rma:declaredRecord\"",
                		"searchparams" :
                		{
                			"records" : true,
                			"undeclaredrecords" : true
                		}
                	},
                	{
                		"name" : "Records Eligible For Cutoff",
                		"description" : "All records currently eligible for cutoff.",
                		"search" : "dispositionActionName:\"cutoff\" AND (dispositionEventsEligible:true OR dispositionActionAsOf:[MIN TO TODAY])",
                		"searchparams" :
                		{
                			"records" : true,
                			"recordfolders" : true
                		}
                	},
                	{
                		"name" : "Records Eligible For Transfer",
                		"description" : "All records currently eligible for transfer.",
                		"search" : "dispositionActionName:\"transfer\" AND (dispositionEventsEligible:true OR dispositionActionAsOf:[MIN TO TODAY])",
                		"searchparams" :
                		{
                			"records" : true,
                			"recordfolders" : true,
                			"cutoff" : true
                		}
                	},
                	{
                		"name" : "Records Eligible For Destruction",
                		"description" : "All records currently eligible for destruction.",
                		"search" : "dispositionActionName:\"destroy\" AND (dispositionEventsEligible:true OR dispositionActionAsOf:[MIN TO TODAY])",
                		"searchparams" :
                		{
                			"records" : true,
                			"recordfolders" : true,
                			"cutoff" : true
                		}
                	},
                	{
                		"name" : "Frozen Records",
                		"description" : "All frozen records.",
                		"search" : "ISNODE:T",
                		"searchparams" :
                		{
                			"records" : true,
                			"recordfolders" : true,
                			"frozen" : true
                		}
                	}
                ]
                ]]>
            </value>
        </property>   
    </bean>
    
    <bean id="RecordsManagementSearchService" class="org.springframework.aop.framework.ProxyFactoryBean">
        <property name="proxyInterfaces">
            <value>org.alfresco.module.org_alfresco_module_dod5015.search.RecordsManagementSearchService</value>
        </property>
        <property name="target">
            <ref bean="recordsManagementSearchService"/>
        </property>
        <property name="interceptorNames">
            <list>
                <idref local="RecordsManagementSearchService_transaction"/>
                <idref bean="exceptionTranslator"/>
                <idref local="RecordsManagementSearchService_security"/>
            </list>
        </property>
    </bean>

    <bean id="RecordsManagementSearchService_transaction" class="org.springframework.transaction.interceptor.TransactionInterceptor">
        <property name="transactionManager">
            <ref bean="transactionManager"/>
        </property>
        <property name="transactionAttributes">
            <props>
                <prop key="*">${server.transaction.mode.default}</prop>
            </props>
        </property>
    </bean>

    <bean id="RecordsManagementSearchService_security" class="org.alfresco.repo.security.permissions.impl.acegi.MethodSecurityInterceptor">
        <property name="authenticationManager">
            <ref bean="authenticationManager"/>
        </property>
        <property name="accessDecisionManager">
            <ref bean="accessDecisionManager"/>
        </property>
        <property name="afterInvocationManager">
            <ref bean="afterInvocationManager"/>
        </property>
        <property name="objectDefinitionSource">
            <value>
                <![CDATA[
                org.alfresco.module.org_alfresco_module_dod5015.search.RecordsManagementSearchService.search=RM_ALLOW
                org.alfresco.module.org_alfresco_module_dod5015.search.RecordsManagementSearchService.getSavedSearches=RM_ALLOW
                org.alfresco.module.org_alfresco_module_dod5015.search.RecordsManagementSearchService.getSavedSearch=RM_ALLOW
                org.alfresco.module.org_alfresco_module_dod5015.search.RecordsManagementSearchService.saveSearch=RM_ALLOW
                org.alfresco.module.org_alfresco_module_dod5015.search.RecordsManagementSearchService.deleteSavedSearch=RM_ALLOW   
                org.alfresco.module.org_alfresco_module_dod5015.search.RecordsManagementSearchService.addReports=RM_ALLOW            
                org.alfresco.module.org_alfresco_module_dod5015.search.RecordsManagementSearchService.*=RM_DENY
                ]]>
            </value>
        </property>
    </bean>
    
    <!-- Records Management Security Service -->
    
    <bean id="recordsManagementSecurityService" class="org.alfresco.module.org_alfresco_module_dod5015.security.RecordsManagementSecurityServiceImpl" depends-on="org_alfresco_module_dod5015_dictionaryBootstrap" init-method="init">        
        <property name="voter" ref="rmEntryVoter"/>
        <property name="authorityService" ref="AuthorityService"/>
        <property name="permissionService" ref="PermissionService"/>
        <property name="nodeService" ref="NodeService"/>
        <property name="policyComponent" ref="policyComponent"/>
        <property name="ownableService" ref="OwnableService"/>
        <property name="recordsManagementService" ref="RecordsManagementService"/>
        <property name="capabilitySets">
        	<map>
        		<entry key="doclibBrowse">
        			<list>
        				 <value>Create</value>
						 <value>UpdateProperties</value>
						 <value>ManageAccessRights</value>
						 <value>Delete</value>
						 <value>AccessAudit</value>
						 <value>CycleVitalRecords</value>
						 <value>ApproveRecordsScheduledForCutoff</value>
						 <value>DestroyRecordsCapability</value>
						 <value>DestroyRecordsScheduledForDestruction</value>
						 <value>AuthorizeAllTransfers</value>
						 <value>AuthorizeNominatedTransfers</value>
						 <value>CreateModifyRecordsInCutoffFolders</value>
						 <value>ManuallyChangeDispositionDates</value>
						 <value>PlanningReviewCycles</value>
						 <value>UndeclareRecords</value>
						 <value>Declare</value>			
						 <value>Unfreeze</value>
						 <value>ViewUpdateReasonsForFreeze</value>
						 <value>CloseFolders</value>
						 <value>ReOpenFolders</value>
						 <value>ExtendRetentionPeriodOrFreeze</value>
        			</list>
        		</entry>
        	</map>
        </property>
    </bean>
    
    <bean id="RecordsManagementSecurityService" class="org.springframework.aop.framework.ProxyFactoryBean">
        <property name="proxyInterfaces">
            <value>org.alfresco.module.org_alfresco_module_dod5015.security.RecordsManagementSecurityService</value>
        </property>
        <property name="target">
            <ref bean="recordsManagementSecurityService"/>
        </property>
        <property name="interceptorNames">
            <list>
                <idref local="RecordsManagementSecurityService_transaction"/>
                <idref bean="exceptionTranslator"/>
                <idref local="RecordsManagementSecurityService_security"/>
            </list>
        </property>
    </bean>

    <bean id="RecordsManagementSecurityService_transaction" class="org.springframework.transaction.interceptor.TransactionInterceptor">
        <property name="transactionManager">
            <ref bean="transactionManager"/>
        </property>
        <property name="transactionAttributes">
            <props>
                <prop key="*">${server.transaction.mode.default}</prop>
            </props>
        </property>
    </bean>

    <bean id="RecordsManagementSecurityService_security" class="org.alfresco.repo.security.permissions.impl.acegi.MethodSecurityInterceptor">
        <property name="authenticationManager">
            <ref bean="authenticationManager"/>
        </property>
        <property name="accessDecisionManager">
            <ref bean="accessDecisionManager"/>
        </property>
        <property name="afterInvocationManager">
            <ref bean="afterInvocationManager"/>
        </property>
        <property name="objectDefinitionSource">
            <value>
                <![CDATA[  
                org.alfresco.module.org_alfresco_module_dod5015.security.RecordsManagementSecurityService.getProtectedAspects=RM_ALLOW
                org.alfresco.module.org_alfresco_module_dod5015.security.RecordsManagementSecurityService.getProtectedProperties=RM_ALLOW
                org.alfresco.module.org_alfresco_module_dod5015.security.RecordsManagementSecurityService.getCapabilities=RM_ALLOW
                org.alfresco.module.org_alfresco_module_dod5015.security.RecordsManagementSecurityService.getCapability=RM_ALLOW                  
                org.alfresco.module.org_alfresco_module_dod5015.security.RecordsManagementSecurityService.setPermission=RM_ALLOW
                org.alfresco.module.org_alfresco_module_dod5015.security.RecordsManagementSecurityService.deletePermission=RM_ALLOW                            
                org.alfresco.module.org_alfresco_module_dod5015.security.RecordsManagementSecurityService.bootstrapDefaultRoles=RM_ALLOW
                org.alfresco.module.org_alfresco_module_dod5015.security.RecordsManagementSecurityService.getRoles=RM_ALLOW
                org.alfresco.module.org_alfresco_module_dod5015.security.RecordsManagementSecurityService.getRolesByUser=RM_ALLOW
                org.alfresco.module.org_alfresco_module_dod5015.security.RecordsManagementSecurityService.getRole=RM_ALLOW
                org.alfresco.module.org_alfresco_module_dod5015.security.RecordsManagementSecurityService.existsRole=RM_ALLOW
                org.alfresco.module.org_alfresco_module_dod5015.security.RecordsManagementSecurityService.hasRMAdminRole=RM_ALLOW
                org.alfresco.module.org_alfresco_module_dod5015.security.RecordsManagementSecurityService.createRole=RM_ALLOW
                org.alfresco.module.org_alfresco_module_dod5015.security.RecordsManagementSecurityService.updateRole=RM_ALLOW
                org.alfresco.module.org_alfresco_module_dod5015.security.RecordsManagementSecurityService.deleteRole=RM_ALLOW
                org.alfresco.module.org_alfresco_module_dod5015.security.RecordsManagementSecurityService.assignRoleToAuthority=RM_ALLOW                     
                ]]>
            </value>
        </property>
    </bean>
    
    <!-- Records Management Action Service -->
    
    <bean id="recordsManagementActionService" class="org.alfresco.module.org_alfresco_module_dod5015.action.RecordsManagementActionServiceImpl" init-method="init">        
        <property name="policyComponent" ref="policyComponent"/>
        <property name="nodeService" ref="NodeService"/>
    </bean>
    
    <bean id="RecordsManagementActionService" class="org.springframework.aop.framework.ProxyFactoryBean">
        <property name="proxyInterfaces">
            <value>org.alfresco.module.org_alfresco_module_dod5015.action.RecordsManagementActionService</value>
        </property>
        <property name="target">
            <ref bean="recordsManagementActionService"/>
        </property>
        <property name="interceptorNames">
            <list>
                <idref local="RecordsManagementActionService_transaction"/>
                <idref bean="exceptionTranslator"/>
                <idref local="RecordsManagementActionService_security"/>
            </list>
        </property>
    </bean>

    <bean id="RecordsManagementActionService_transaction" class="org.springframework.transaction.interceptor.TransactionInterceptor">
        <property name="transactionManager">
            <ref bean="transactionManager"/>
        </property>
        <property name="transactionAttributes">
            <props>
                <prop key="*">${server.transaction.mode.default}</prop>
            </props>
        </property>
    </bean>

    
    <bean id="RecordsManagementActionService_security" class="org.alfresco.repo.security.permissions.impl.acegi.MethodSecurityInterceptor">
        <property name="authenticationManager">
            <ref bean="authenticationManager"/>
        </property>
        <property name="accessDecisionManager">
            <ref bean="accessDecisionManager"/>
        </property>
        <property name="afterInvocationManager">
            <ref bean="afterInvocationManager"/>
        </property>
        <property name="objectDefinitionSource">
            <value>
                <![CDATA[  
                org.alfresco.module.org_alfresco_module_dod5015.action.RecordsManagementActionService.getRecordsManagementActions=RM_ALLOW
                org.alfresco.module.org_alfresco_module_dod5015.action.RecordsManagementActionService.getDispositionActions=RM_ALLOW
                org.alfresco.module.org_alfresco_module_dod5015.action.RecordsManagementActionService.getRecordsManagementAction=RM_ALLOW
                org.alfresco.module.org_alfresco_module_dod5015.action.RecordsManagementActionService.getDispositionAction=RM_ALLOW
                org.alfresco.module.org_alfresco_module_dod5015.action.RecordsManagementActionService.executeRecordsManagementAction=RM_ALLOW
                org.alfresco.module.org_alfresco_module_dod5015.action.RecordsManagementActionService.executeRecordsManagementAction=RM_ALLOW
                org.alfresco.module.org_alfresco_module_dod5015.action.RecordsManagementActionService.executeRecordsManagementAction=RM_ALLOW
                org.alfresco.module.org_alfresco_module_dod5015.action.RecordsManagementActionService.executeRecordsManagementAction=RM_ALLOW
                org.alfresco.module.org_alfresco_module_dod5015.action.RecordsManagementActionService.executeRecordsManagementAction=RM_ALLOW
                org.alfresco.module.org_alfresco_module_dod5015.action.RecordsManagementActionService.register=RM_ALLOW
                org.alfresco.module.org_alfresco_module_dod5015.action.RecordsManagementActionService.*=RM_DENY
                ]]>
            </value>
        </property>
    </bean>
    
    <!-- Records Management Event Service -->
    
    <bean id="recordsManagementEventService" class="org.alfresco.module.org_alfresco_module_dod5015.event.RecordsManagementEventServiceImpl">
      <property name="nodeService" ref="NodeService"/>
      <property name="contentService" ref="ContentService"/>
    </bean>
    
    <bean id="RecordsManagementEventService" class="org.springframework.aop.framework.ProxyFactoryBean">
        <property name="proxyInterfaces">
            <value>org.alfresco.module.org_alfresco_module_dod5015.event.RecordsManagementEventService</value>
        </property>
        <property name="target">
            <ref bean="recordsManagementEventService"/>
        </property>
        <property name="interceptorNames">
            <list>
                <idref local="RecordsManagementEventService_transaction"/>
                <idref bean="exceptionTranslator"/>
                <idref local="RecordsManagementEventService_security"/>
            </list>
        </property>
    </bean>

    <bean id="RecordsManagementEventService_transaction" class="org.springframework.transaction.interceptor.TransactionInterceptor">
        <property name="transactionManager">
            <ref bean="transactionManager"/>
        </property>
        <property name="transactionAttributes">
            <props>
                <prop key="*">${server.transaction.mode.default}</prop>
            </props>
        </property>
    </bean>

   
    <bean id="RecordsManagementEventService_security" class="org.alfresco.repo.security.permissions.impl.acegi.MethodSecurityInterceptor">
        <property name="authenticationManager">
            <ref bean="authenticationManager"/>
        </property>
        <property name="accessDecisionManager">
            <ref bean="accessDecisionManager"/>
        </property>
        <property name="afterInvocationManager">
            <ref bean="afterInvocationManager"/>
        </property>
        <property name="objectDefinitionSource">
            <value>
                <![CDATA[  
                org.alfresco.module.org_alfresco_module_dod5015.event.RecordsManagementEventService.registerEventType=RM_ALLOW
                org.alfresco.module.org_alfresco_module_dod5015.event.RecordsManagementEventService.getEventTypes=RM_ALLOW
                org.alfresco.module.org_alfresco_module_dod5015.event.RecordsManagementEventService.getEventType=RM_ALLOW
                org.alfresco.module.org_alfresco_module_dod5015.event.RecordsManagementEventService.getEvents=RM_ALLOW
                org.alfresco.module.org_alfresco_module_dod5015.event.RecordsManagementEventService.getEvent=RM_ALLOW
                org.alfresco.module.org_alfresco_module_dod5015.event.RecordsManagementEventService.addEvent=RM_ALLOW
                org.alfresco.module.org_alfresco_module_dod5015.event.RecordsManagementEventService.removeEvent=RM_ALLOW
                org.alfresco.module.org_alfresco_module_dod5015.event.RecordsManagementEventService.existsEvent=RM_ALLOW
                org.alfresco.module.org_alfresco_module_dod5015.event.RecordsManagementEventService.*=RM_DENY
                ]]>
            </value>
        </property>
    </bean>
    
    <!-- Records Management Admin Service -->
    
    <bean id="recordsManagementAdminService" class="org.alfresco.module.org_alfresco_module_dod5015.RecordsManagementAdminServiceImpl" init-method="init">
        <property name="dictionaryService" ref="DictionaryService"/>
        <property name="namespaceService" ref="NamespaceService"/>
        <property name="nodeService" ref="NodeService"/>
        <property name="policyComponent" ref="policyComponent"/>
        <property name="contentService" ref="contentService"/>
        <property name="dictionaryRepositoryBootstrap" ref="dictionaryRepositoryBootstrap"/>
        <property name="customisableTypes">
        	<list>
        		<value>rma:recordFolder</value>
        		<value>rma:record</value>
        		<value>rma:nonElectronicDocument</value>        		       
        	</list>
        </property>
    </bean>
    
    <bean id="RecordsManagementAdminService" class="org.springframework.aop.framework.ProxyFactoryBean">
        <property name="proxyInterfaces">
            <value>org.alfresco.module.org_alfresco_module_dod5015.RecordsManagementAdminService</value>
        </property>
        <property name="target">
            <ref bean="recordsManagementAdminService"/>
        </property>
        <property name="interceptorNames">
            <list>
                <idref local="RecordsManagementAdminService_transaction"/>
                <idref bean="exceptionTranslator"/>
                <idref local="RecordsManagementAdminService_security"/>
            </list>
        </property>
    </bean>

    <bean id="RecordsManagementAdminService_transaction" class="org.springframework.transaction.interceptor.TransactionInterceptor">
        <property name="transactionManager">
            <ref bean="transactionManager"/>
        </property>
        <property name="transactionAttributes">
            <props>
                <prop key="*">${server.transaction.mode.default}</prop>
            </props>
        </property>
    </bean>

    
    <bean id="RecordsManagementAdminService_security" class="org.alfresco.repo.security.permissions.impl.acegi.MethodSecurityInterceptor">
        <property name="authenticationManager">
            <ref bean="authenticationManager"/>
        </property>
        <property name="accessDecisionManager">
            <ref bean="accessDecisionManager"/>
        </property>
        <property name="afterInvocationManager">
            <ref bean="afterInvocationManager"/>
        </property>
        <property name="objectDefinitionSource">
            <value>
                <![CDATA[  
                org.alfresco.module.org_alfresco_module_dod5015.RecordsManagementAdminService.initialiseCustomModel=RM_ALLOW
                org.alfresco.module.org_alfresco_module_dod5015.RecordsManagementAdminService.getCustomisable=RM_ALLOW
				org.alfresco.module.org_alfresco_module_dod5015.RecordsManagementAdminService.isCustomisable=RM_ALLOW
				org.alfresco.module.org_alfresco_module_dod5015.RecordsManagementAdminService.makeCustomisable=RM_ALLOW
				org.alfresco.module.org_alfresco_module_dod5015.RecordsManagementAdminService.unmakeCustomisable=RM_ALLOW
				org.alfresco.module.org_alfresco_module_dod5015.RecordsManagementAdminService.existsCustomProperty=RM_ALLOW
                org.alfresco.module.org_alfresco_module_dod5015.RecordsManagementAdminService.getCustomPropertyDefinitions=RM_ALLOW
                org.alfresco.module.org_alfresco_module_dod5015.RecordsManagementAdminService.addCustomPropertyDefinition=RM_ALLOW
                org.alfresco.module.org_alfresco_module_dod5015.RecordsManagementAdminService.setCustomPropertyDefinitionLabel=RM_ALLOW
                org.alfresco.module.org_alfresco_module_dod5015.RecordsManagementAdminService.setCustomPropertyDefinitionConstraint=RM_ALLOW
                org.alfresco.module.org_alfresco_module_dod5015.RecordsManagementAdminService.removeCustomPropertyDefinitionConstraints=RM_ALLOW
                org.alfresco.module.org_alfresco_module_dod5015.RecordsManagementAdminService.removeCustomPropertyDefinition=RM_ALLOW
                org.alfresco.module.org_alfresco_module_dod5015.RecordsManagementAdminService.addCustomAssocDefinition=RM_ALLOW
                org.alfresco.module.org_alfresco_module_dod5015.RecordsManagementAdminService.addCustomChildAssocDefinition=RM_ALLOW
                org.alfresco.module.org_alfresco_module_dod5015.RecordsManagementAdminService.updateCustomAssocDefinition=RM_ALLOW
                org.alfresco.module.org_alfresco_module_dod5015.RecordsManagementAdminService.updateCustomChildAssocDefinition=RM_ALLOW
                org.alfresco.module.org_alfresco_module_dod5015.RecordsManagementAdminService.getCustomReferenceDefinitions=RM_ALLOW
                org.alfresco.module.org_alfresco_module_dod5015.RecordsManagementAdminService.getCustomReferencesFrom=RM_ALLOW
                org.alfresco.module.org_alfresco_module_dod5015.RecordsManagementAdminService.getCustomReferencesTo=RM_ALLOW
                org.alfresco.module.org_alfresco_module_dod5015.RecordsManagementAdminService.getCustomChildReferences=RM_ALLOW
                org.alfresco.module.org_alfresco_module_dod5015.RecordsManagementAdminService.getCustomParentReferences=RM_ALLOW
                org.alfresco.module.org_alfresco_module_dod5015.RecordsManagementAdminService.addCustomReference=RM_ALLOW
                org.alfresco.module.org_alfresco_module_dod5015.RecordsManagementAdminService.removeCustomReference=RM_ALLOW
                org.alfresco.module.org_alfresco_module_dod5015.RecordsManagementAdminService.getCustomConstraintDefinitions=RM_ALLOW
                org.alfresco.module.org_alfresco_module_dod5015.RecordsManagementAdminService.addCustomConstraintDefinition=RM_ALLOW
                org.alfresco.module.org_alfresco_module_dod5015.RecordsManagementAdminService.removeCustomConstraintDefinition=RM_ALLOW
                org.alfresco.module.org_alfresco_module_dod5015.RecordsManagementAdminService.changeCustomConstraintValues=RM_ALLOW
                org.alfresco.module.org_alfresco_module_dod5015.RecordsManagementAdminService.getQNameForClientId=RM_ALLOW
                org.alfresco.module.org_alfresco_module_dod5015.RecordsManagementAdminService.splitSourceTargetId=RM_ALLOW
                org.alfresco.module.org_alfresco_module_dod5015.RecordsManagementAdminService.getCompoundIdFor=RM_ALLOW
                org.alfresco.module.org_alfresco_module_dod5015.RecordsManagementAdminService.*=RM_DENY
                ]]>
            </value>
        </property>
    </bean>
    
    <!-- Records Management Audit Service -->
    
    <bean id="recordsManagementAuditService" class="org.alfresco.module.org_alfresco_module_dod5015.audit.RecordsManagementAuditServiceImpl" init-method="init">
        <property name="policyComponent" ref="policyComponent" />
        <property name="dictionaryService" ref="dictionaryService" />
        <property name="transactionService" ref="transactionService" />
        <property name="nodeService" ref="nodeService" />
        <property name="auditComponent" ref="auditComponent" />
        <property name="auditService" ref="auditService" />
        <property name="contentService" ref="ContentService" />
        <property name="recordsManagementService" ref="RecordsManagementService" />
        <property name="recordsManagementActionService" ref="RecordsManagementActionService" />
    </bean>
    
    <bean id="RecordsManagementAuditService" class="org.springframework.aop.framework.ProxyFactoryBean">
        <property name="proxyInterfaces">
            <value>org.alfresco.module.org_alfresco_module_dod5015.audit.RecordsManagementAuditService</value>
        </property>
        <property name="target">
            <ref bean="recordsManagementAuditService"/>
        </property>
        <property name="interceptorNames">
            <list>
                <idref local="RecordsManagementAuditService_transaction"/>
                <idref bean="exceptionTranslator"/>
                <idref local="RecordsManagementAuditService_security"/>
            </list>
        </property>
    </bean>

    <bean id="RecordsManagementAuditService_transaction" class="org.springframework.transaction.interceptor.TransactionInterceptor">
        <property name="transactionManager">
            <ref bean="transactionManager"/>
        </property>
        <property name="transactionAttributes">
            <props>
                <prop key="*">${server.transaction.mode.default}</prop>
            </props>
        </property>
    </bean>
    
    <bean id="RecordsManagementAuditService_security" class="org.alfresco.repo.security.permissions.impl.acegi.MethodSecurityInterceptor">
        <property name="authenticationManager">
            <ref bean="authenticationManager"/>
        </property>
        <property name="accessDecisionManager">
            <ref bean="accessDecisionManager"/>
        </property>
        <property name="afterInvocationManager">
            <ref bean="afterInvocationManager"/>
        </property>
        <property name="objectDefinitionSource">
            <value>
                <![CDATA[  
                org.alfresco.module.org_alfresco_module_dod5015.audit.RecordsManagementAuditService.clear=RM_CAP.-1.rma:filePlanComponent.DeleteAudit
                org.alfresco.module.org_alfresco_module_dod5015.audit.RecordsManagementAuditService.getAuditTrail=RM_ALLOW
                org.alfresco.module.org_alfresco_module_dod5015.audit.RecordsManagementAuditService.getAuditTrailFile=RM_ALLOW
                org.alfresco.module.org_alfresco_module_dod5015.audit.RecordsManagementAuditService.getDateLastStarted=RM_ALLOW
                org.alfresco.module.org_alfresco_module_dod5015.audit.RecordsManagementAuditService.getDateLastStopped=RM_ALLOW
                org.alfresco.module.org_alfresco_module_dod5015.audit.RecordsManagementAuditService.isEnabled=RM_ALLOW
                org.alfresco.module.org_alfresco_module_dod5015.audit.RecordsManagementAuditService.start=RM_CAP.-1.rma:filePlanComponent.EnableDisableAuditByTypes
                org.alfresco.module.org_alfresco_module_dod5015.audit.RecordsManagementAuditService.stop=RM_CAP.-1.rma:filePlanComponent.EnableDisableAuditByTypes
                org.alfresco.module.org_alfresco_module_dod5015.audit.RecordsManagementAuditService.fileAuditTrailAsRecord=RM_CAP.-1.rma:filePlanComponent.DeclareAuditAsRecord
                org.alfresco.module.org_alfresco_module_dod5015.audit.RecordsManagementAuditService.getAuditEvents=RM_ALLOW
                org.alfresco.module.org_alfresco_module_dod5015.audit.RecordsManagementAuditService.*=RM_DENY
                ]]>
            </value>
        </property>
    </bean>
    
    <!--  Custom EMail Mapping Service -->
    
    <bean id="customEmailMappingService" 
      class="org.alfresco.module.org_alfresco_module_dod5015.email.CustomEmailMappingServiceImpl" >
      <property name="extracter" ref="extracter.RFC822" />
      <property name="nodeService" ref="nodeService" />
      <property name="contentService" ref="contentService"/>
      <property name="namespacePrefixResolver">
            <ref bean="namespaceService"></ref>
      </property>
      <property name="policyComponent"><ref bean="policyComponent" /></property>
      <property name="transactionService"><ref bean="transactionService" /></property>
   
    </bean>
    
    
    <bean id="CustomEmailMappingService_transaction" class="org.springframework.transaction.interceptor.TransactionInterceptor">
        <property name="transactionManager">
            <ref bean="transactionManager"/>
        </property>
        <property name="transactionAttributes">
            <props>
                <prop key="*">${server.transaction.mode.default}</prop>
            </props>
        </property>
    </bean>
    
        <bean id="CustomEmailMappingService_security" class="org.alfresco.repo.security.permissions.impl.acegi.MethodSecurityInterceptor">
        <property name="authenticationManager">
            <ref bean="authenticationManager"/>
        </property>
        <property name="accessDecisionManager">
            <ref bean="accessDecisionManager"/>
        </property>
        <property name="afterInvocationManager">
            <ref bean="afterInvocationManager"/>
        </property>
        <property name="objectDefinitionSource">
            <value>
                <![CDATA[ 
                    org.alfresco.module.org_alfresco_module_dod5015.email.CustomEmailMappingService.getCustomMappings=RM_ALLOW
                    org.alfresco.module.org_alfresco_module_dod5015.email.CustomEmailMappingService.addCustomMapping=RM_ALLOW
                    org.alfresco.module.org_alfresco_module_dod5015.email.CustomEmailMappingService.deleteCustomMapping=RM_ALLOW
                    org.alfresco.module.org_alfresco_module_dod5015.email.CustomEmailMappingService.*=RM_DENY
                ]]>
            </value>
        </property>
    </bean>

        
    <bean id="CustomEmailMappingService" class="org.springframework.aop.framework.ProxyFactoryBean">
        <property name="proxyInterfaces">
            <list>
                <value>org.alfresco.module.org_alfresco_module_dod5015.email.CustomEmailMappingService</value>
            </list>
        </property>
        <property name="targetName">
            <value>customEmailMappingService</value>
        </property>
        <property name="interceptorNames">
            <list>
                <idref local="CustomEmailMappingService_transaction"/>
                <idref local="CustomEmailMappingService_security"/>
                <idref bean="exceptionTranslator"/>
            </list>
        </property>
    </bean>
    
    <!--  RM Notification Helper -->
            
    <bean id="recordsManagementNotificationHelper" class="org.alfresco.module.org_alfresco_module_dod5015.notification.RecordsManagementNotificationHelper" >        
        <property name="securityService" ref="RecordsManagementSecurityService"/>
    	<property name="notificationService" ref="NotificationService"/>
    	<property name="recordsManagementService" ref="RecordsManagementService"/>
    	<property name="repositoryHelper" ref="repositoryHelper" />
        <property name="namespaceService" ref="namespaceService"/>
        <property name="searchService" ref="searchService"/>
        <property name="siteService" ref="SiteService" />
    	<property name="notificationRole" value="${rm.notification.role}"/>
    </bean>    
    
    <!-- RM caveats -->
    
    <bean id="caveatConfigService" class="org.alfresco.module.org_alfresco_module_dod5015.caveat.RMCaveatConfigServiceImpl">
        <property name="caveatConfigComponent" ref="caveatConfigComponent"/>
        <property name="dictionaryService" ref="dictionaryService"/>
        <property name="namespaceService" ref="namespaceService" />
        <property name="recordsManagementAdminService" ref = "recordsManagementAdminService"/>
    </bean>
    
    <bean id="caveatConfigComponent" class="org.alfresco.module.org_alfresco_module_dod5015.caveat.RMCaveatConfigComponentImpl">
        <property name="policyComponent" ref="policyComponent"/>
        <property name="contentService" ref="contentService"/>
        <property name="dictionaryService" ref="dictionaryService"/>
        <property name="namespaceService" ref="namespaceService"/>
        <property name="authorityService" ref="authorityService"/>
        <property name="personService" ref="personService"/>
        <property name="nodeService" ref="nodeService"/>
        
        <property name="caveatAspects" ref="caveatAspects"/>
        <property name="caveatModels" ref="caveatModels"/>
        
    </bean>
    
    <bean id="caveatAspects" class="java.util.ArrayList" >
      <constructor-arg>
         <list>
            <value>{http://www.alfresco.org/model/recordsmanagement/1.0}recordComponentIdentifier</value>
         </list>
      </constructor-arg>
   </bean>
   
   <bean id="caveatModels" class="java.util.ArrayList" >
      <constructor-arg>
         <list>
            <value>{http://www.alfresco.org/model/rmcustom/1.0}rmcustom</value>
         </list>
      </constructor-arg>
   </bean>
    
    <bean id="rmListOfValuesContraintInit" class="org.alfresco.module.org_alfresco_module_dod5015.caveat.RMListOfValuesConstraint">
        <property name="caveatConfigService" ref="caveatConfigService"/>
    </bean>
    
    <bean id="CaveatConfigService_security" class="org.alfresco.repo.security.permissions.impl.acegi.MethodSecurityInterceptor">
        <property name="authenticationManager">
            <ref bean="authenticationManager"/>
        </property>
        <property name="accessDecisionManager">
            <ref bean="accessDecisionManager"/>
        </property>
        <property name="afterInvocationManager">
            <ref bean="afterInvocationManager"/>
        </property>
        <property name="objectDefinitionSource">
            <value>
                <![CDATA[ 
                   org.alfresco.module.org_alfresco_module_dod5015.caveat.RMCaveatConfigService.getRMAllowedValues=RM_ALLOW  
                   org.alfresco.module.org_alfresco_module_dod5015.caveat.RMCaveatConfigService.hasAccess=RM_ALLOW
                   org.alfresco.module.org_alfresco_module_dod5015.caveat.RMCaveatConfigService.getRMConstraint=RM_ALLOW
                   org.alfresco.module.org_alfresco_module_dod5015.caveat.RMCaveatConfigService.getAllRMConstraints=RM_ALLOW
                   org.alfresco.module.org_alfresco_module_dod5015.caveat.RMCaveatConfigService.getListDetails=RM_ALLOW
                   org.alfresco.module.org_alfresco_module_dod5015.caveat.RMCaveatConfigService.updateOrCreateCaveatConfig=RM_ALLOW
                   org.alfresco.module.org_alfresco_module_dod5015.caveat.RMCaveatConfigService.addRMConstraint=RM_ALLOW
                   org.alfresco.module.org_alfresco_module_dod5015.caveat.RMCaveatConfigService.updateRMConstraintAllowedValues=RM_ALLOW
                   org.alfresco.module.org_alfresco_module_dod5015.caveat.RMCaveatConfigService.updateRMConstraintTitle=RM_ALLOW
                   org.alfresco.module.org_alfresco_module_dod5015.caveat.RMCaveatConfigService.deleteRMConstraint=RM_ALLOW
                   org.alfresco.module.org_alfresco_module_dod5015.caveat.RMCaveatConfigService.addRMConstraintListValue=RM_ALLOW 
                   org.alfresco.module.org_alfresco_module_dod5015.caveat.RMCaveatConfigService.updateRMConstraintListAuthority=RM_ALLOW
                   org.alfresco.module.org_alfresco_module_dod5015.caveat.RMCaveatConfigService.removeRMConstraintListAuthority=RM_ALLOW
                   org.alfresco.module.org_alfresco_module_dod5015.caveat.RMCaveatConfigService.updateRMConstraintListValue=RM_ALLOW
                   org.alfresco.module.org_alfresco_module_dod5015.caveat.RMCaveatConfigService.removeRMConstraintListValue=RM_ALLOW
                   org.alfresco.module.org_alfresco_module_dod5015.caveat.RMCaveatConfigService.*=RM_DENY
                ]]>
            </value>
        </property>
    </bean>         

    <bean id="CaveatConfigService_transaction" class="org.springframework.transaction.interceptor.TransactionInterceptor">
        <property name="transactionManager">
            <ref bean="transactionManager"/>
        </property>
        <property name="transactionAttributes">
            <props>
                <prop key="*">${server.transaction.mode.default}</prop>
            </props>
        </property>
    </bean>
    
    <bean id="CaveatConfigService" class="org.springframework.aop.framework.ProxyFactoryBean">
        <property name="proxyInterfaces">
            <list>
                <value>org.alfresco.module.org_alfresco_module_dod5015.caveat.RMCaveatConfigService</value>
            </list>
        </property>
        <property name="targetName">
            <value>caveatConfigService</value>
        </property>
        <property name="interceptorNames">
            <list>
                <idref local="CaveatConfigService_transaction"/>
                <idref local="CaveatConfigService_security"/>
                <idref bean="exceptionTranslator"/>
            </list>
        </property>
    </bean>
    
    <!-- Period Properties -->
    
    <bean id="DispositionPeriodProperties" class="org.alfresco.module.org_alfresco_module_dod5015.disposition.DispositionPeriodProperties">
        <property name="propertyList">
            <list>
                <value>{http://www.alfresco.org/model/recordsmanagement/1.0}cutOffDate</value>
                <value>{http://www.alfresco.org/model/recordsmanagement/1.0}dispositionAsOf</value>
                <value>{http://www.alfresco.org/model/recordsmanagement/1.0}dateFiled</value>
                <value>{http://www.alfresco.org/model/recordsmanagement/1.0}publicationDate</value>
            </list>
        </property>
    </bean>
    
</beans>    