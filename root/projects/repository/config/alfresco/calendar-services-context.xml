<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE beans PUBLIC '-//SPRING//DTD BEAN//EN' 'http://www.springframework.org/dtd/spring-beans.dtd'>

<beans>

   <!-- Calendar Service -->
   <bean id="CalendarService" class="org.springframework.aop.framework.ProxyFactoryBean">
      <property name="proxyInterfaces">
         <value>org.alfresco.service.cmr.calendar.CalendarService</value>
      </property>
      <property name="target">
         <ref bean="calendarService" />
      </property>
      <property name="interceptorNames">
         <list>
            <idref local="CalendarService_transaction" />
            <idref bean="AuditMethodInterceptor" />
            <idref bean="exceptionTranslator" />
            <idref bean="CalendarService_security" />
         </list>
      </property>
   </bean>

   <!-- Calendar service transaction bean -->
   <bean id="CalendarService_transaction"
      class="org.springframework.transaction.interceptor.TransactionInterceptor">
      <property name="transactionManager">
         <ref bean="transactionManager" />
      </property>
      <property name="transactionAttributes">
         <props>
            <prop key="*">${server.transaction.mode.default}</prop>
         </props>
      </property>
   </bean>

   <!-- List of Calendar Canned queries -->
   <bean id="calendarCannedQueryRegistry" class="org.alfresco.util.registry.NamedObjectRegistry">
       <property name="storageType" value="org.alfresco.query.CannedQueryFactory"/>
   </bean>
    
   <!-- The regular GetChildren Canned Query Factory -->
   <bean name="calendarGetChildrenCannedQueryFactory" class="org.alfresco.repo.node.getchildren.GetChildrenCannedQueryFactory">
       <property name="registry" ref="calendarCannedQueryRegistry"/>
       <property name="dictionaryService" ref="dictionaryService"/>
       <property name="tenantService" ref="tenantService"/>
       <property name="nodeDAO" ref="nodeDAO"/>
       <property name="qnameDAO" ref="qnameDAO"/>
       <property name="localeDAO" ref="localeDAO"/>
       <property name="contentDataDAO" ref="contentDataDAO"/>
       <property name="cannedQueryDAO" ref="cannedQueryDAO"/>
       <property name="methodSecurity" ref="CalendarService_security_listCalendarEntries"/>
   </bean>

   <!-- The multiple site, Date filtering GetChildren Canned Query Factory -->
   <bean name="calendarGetCalendarEntriesCannedQueryFactory" class="org.alfresco.repo.calendar.cannedqueries.GetCalendarEntriesCannedQueryFactory">
       <property name="registry" ref="calendarCannedQueryRegistry"/>
       <property name="taggingService" ref="taggingService"/>
       <property name="tenantService" ref="tenantService"/>
       <property name="nodeService" ref="nodeService"/>
       <property name="nodeDAO" ref="nodeDAO"/>
       <property name="qnameDAO" ref="qnameDAO"/>
       <property name="cannedQueryDAO" ref="cannedQueryDAO"/>
       <property name="methodSecurity" ref="CalendarService_security_listCalendarEntries"/>
   </bean>

   <!-- Calendar Service base bean -->
	<bean id="calendarService" class="org.alfresco.repo.calendar.CalendarServiceImpl">
        <property name="nodeDAO" ref="nodeDAO" />
        <property name="nodeService" ref="NodeService"/>
        <property name="siteService" ref="SiteService"/>
        <property name="taggingService" ref="TaggingService"/>
        <property name="permissionService" ref="PermissionService"/>
        <property name="transactionService" ref="transactionService" />
        <property name="cannedQueryRegistry" ref="calendarCannedQueryRegistry" />
	</bean>

</beans>
